<!DOCTYPE html>
<html>
<head>
    <style>
        :root {
            --square-size: 15vw; /* You can change this to tweak the size of the squares */
            --circle-size: 75px; /* This is the size of the colored circles in the radio button */
            --custom-whitish: #f0f0f0;
        }

        body {
            display: flex;
            flex-direction: column; /* This makes the grid and the button stack vertically */
            justify-content: flex-start; /* This places the grid and the button towards the top */
            align-items: center; /* This centers the grid and the button horizontally */
            height: 100vh;
            margin: 0;
            background-color: var(--custom-whitish);
            padding-top: 20px;
        }

        #show-keyboard-button {
            width: 200px;
            height: 50px;
            margin-top: 20px;
            font-size: 20px;
        }

        #request-word-button {
            width: 200px;
            height: 100px;
            margin-top: 20px;
            font-size: 20px;
        }

        #grid-container {
            display: grid;
            grid-template-columns: repeat(5, var(--square-size));
            grid-template-rows: repeat(6, var(--square-size));
            gap: 10px;
            padding-bottom: 20px;
            /* background-color: gray; */
        }



        .grid-item {
            width: var(--square-size);
            height: var(--square-size);
            background-color: var(--custom-whitish);
            border: 3px solid gray;

            /* The following part is about the text in the boxes */
            display: flex;
            justify-content: center;
            align-items: center;
            text-align: center;
            font-size: calc(var(--square-size) / 1.2); /* Make the font barely smaller than the squares */
        }

        .color-option {
            display: inline-block;
            width: var(--circle-size);
            height: var(--circle-size);
            border: 2px solid black;
            border-radius: 50%;
            margin: 10px;
        }

        /* Use these classes to set the color of each option */
        .green { background-color: green; }
        .yellow { background-color: yellow; }
        .grey { background-color: grey;}

        /* Hide the actual radio buttons */
        .color-radio {
            display: none;
        }

        /* Style the selected option */
        .color-radio:checked + .color-option {
            border: 10px solid black;
        }

        #radio-container {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        #available-words {
            font-size: 40px;
            word-wrap: break-word;
            padding-left: 20px;
            padding-right: 20px;
        }

    </style>

    <script src="utils.js"></script>
    <script src="valid_words.js"></script>
</head>
    <body>
        <div id="grid-container"></div>

        <div id="radio-container">
            <input type="radio" id="green" name="color" class="color-radio">
            <label for="green" class="color-option green"></label>
        
            <input type="radio" id="yellow" name="color" class="color-radio">
            <label for="yellow" class="color-option yellow"></label>
        
            <input type="radio" id="grey" name="color" class="color-radio">
            <label for="grey" class="color-option grey"></label>
        
        </div>

        <script src="radio_script.js"></script>

        <input type="text" id="hidden-input" style="opacity: 0; position: absolute; pointer-events: none;">

        <button id="show-keyboard-button">Show Keyboard</button>

        <button id="request-word-button">See possible words</button>

        <p id="available-words"></p>

        <script>

            // get rid of this in prod. Only here so I can know when a change goes through
            // window.onload = () => { alert('Page refreshed at ' + new Date().toLocaleTimeString()); };

            // Generate the grid squares
            const gridContainer = getElemById('grid-container');
            for (let i = 0; i < 30; i++) {
                const div = document.createElement('div');
                div.classList.add('grid-item');
                div.id = `grid-item-${i}`; // give each square it's own id so I can get it easily
                div.addEventListener('click', function(){
                    this.style.backgroundColor = radio_ns.get_selected_color();
                });
                gridContainer.appendChild(div);
            }


            const show_keyboard_button = getElemById('show-keyboard-button');

            // trick to make keyboard show up on mobile devices.
            show_keyboard_button.addEventListener('click', () => {
                getElemById('hidden-input').focus();
            });

            // code for handling typing in the squares
            let index = 0;

            function incIndex(){
                if(index < 29){
                    index++;
                }
            }

            function decIndex(){
                if(index > 0){
                    index--;
                }
            }

            function isSingleLetter(str) {
                let regex = /^[A-Za-z]+$/;
                return str.length === 1 && regex.test(str);
            }


            document.body.addEventListener('keydown', (event) => {
                let key_str = event.key;
                const square = getElemById(`grid-item-${index}`);

                if(isSingleLetter(key_str)){
                    assert(square, "didn't find a square w/ index: " + index);
                    square.textContent = key_str.toLocaleUpperCase();
                    incIndex();
                } else if(key_str == 'Backspace'){
                    square.textContent = "";
                    square.style.backgroundColor = getCustomWhitishHex();
                    decIndex();
                }
            });


            // code for when they ask for a new word
            const colorOptions = {
                'white': getCustomWhitishRGB(),
                'green': getComputedStyle(document.querySelector('.green')).backgroundColor,
                'yellow': getComputedStyle(document.querySelector('.yellow')).backgroundColor,
                'grey': getComputedStyle(document.querySelector('.grey')).backgroundColor
            };


            function getGridData() {
                // Compute the RGB value of each color option
                const gridData = [];
                for(let i = 0; i < 30; i++) {
                    const square = document.getElementById(`grid-item-${i}`);
                    const color = getComputedStyle(square).backgroundColor; // Get the current background color
                    const text = square.textContent; // Get the text content

                    let readableColor = 'unknown color';
                    // Compare the square's color with each color option
                    for (const [option, rgb] of Object.entries(colorOptions)) {
                        if (color === rgb) {
                            readableColor = option;
                            break;
                        }
                    }
                    assert(readableColor != 'unknown color', 'one of the colors could not be correctly found');
                    
                    gridData.push({color: readableColor, text: text}); // Push an object with the color and text to the array
                }
                return gridData;
            }

            function get_known_colored_letters(){
                let grid_data = getGridData();
                let letters_per_row = 5;
                let result = [];
                for(let i = 0; i < grid_data.length; i++){
                    let column_index = i % letters_per_row; // the index of the letter in it's 5 letter word
                    let cell_data = grid_data[i];
                    if(cell_data.color != 'white' && cell_data.text != ''){
                        result.push({
                            color: cell_data.color,
                            text: cell_data.text.toLowerCase(),
                            index: column_index
                        });
                    }
                }
                return result;
            }

            function is_possible(candidate_word, known_colored_letters){
                for(const colored_letter of known_colored_letters){
                    let color = colored_letter.color;
                    let letter = colored_letter.text;
                    let index = colored_letter.index;
                    if(color === 'green'){
                        if(candidate_word[index] !== letter){
                            return false;
                        }
                    }
                    else if(color === 'yellow'){
                        if(!candidate_word.includes(letter) || candidate_word[index] === letter){
                            return false;
                        }
                    }
                    else{
                        assert(color === 'grey', 'color was not in the allowed list of colors. It was: ' + color);
                        if(candidate_word.includes(letter)){
                            return false;
                        }
                    }
                }
                return true;
            }

            function get_possible_words(){
                let all_words = get_valid_words(); // definied in valid_words.js
                let known_colored_letters = get_known_colored_letters();
                let remaining_words = [];
                for(let word of all_words){
                    if(is_possible(word, known_colored_letters)){
                        remaining_words.push(word);
                    }
                }
                return remaining_words;
            }



            const request_word_button = getElemById('request-word-button');

            request_word_button.addEventListener('click', function(){
                getElemById('available-words').textContent = lst_to_txt(get_possible_words());
            });

        </script>
    </body>
</html>
